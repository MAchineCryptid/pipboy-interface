import pygame
import sys

# Initialize Pygame
pygame.init()

# Screen settings
WIDTH, HEIGHT = 800, 480  # Adjust for your HDMI LCD screen
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("Raspberry Pi Pip-Boy")

# Colors
GREEN = (57, 255, 20)  # Classic Pip-Boy green
BLACK = (0, 0, 0)

# Fonts
font = pygame.font.Font(None, 36)
small_font = pygame.font.Font(None, 24)

# Screen types (tabs)
MAIN_SCREEN = 0
GPS_SCREEN = 1
WIKI_SCREEN = 2
RADIO_SCREEN = 3

# Start on the main screen
current_screen = MAIN_SCREEN
previous_screen = MAIN_SCREEN

# Surface for the screen content
screen_content = pygame.Surface((WIDTH, HEIGHT))

def draw_text(text, x, y, font_size=36, color=GREEN):
    font = pygame.font.Font(None, font_size)
    rendered_text = font.render(text, True, color)
    screen_content.blit(rendered_text, (x, y))

def fade_in():
    for alpha in range(0, 255, 5):  # Gradually increase alpha
        overlay = pygame.Surface((WIDTH, HEIGHT))
        overlay.fill((0, 0, 0))
        overlay.set_alpha(alpha)
        screen.blit(overlay, (0, 0))
        pygame.display.flip()
        pygame.time.delay(1)  # Faster fade-in delay

def fade_out():
    for alpha in range(255, 0, -5):  # Gradually decrease alpha
        overlay = pygame.Surface((WIDTH, HEIGHT))
        overlay.fill((0, 0, 0))
        overlay.set_alpha(alpha)
        screen.blit(overlay, (0, 0))
        pygame.display.flip()
        pygame.time.delay(1)  # Faster fade-out delay

def draw_main_screen():
    screen_content.fill(BLACK)  # Clear the screen content surface
    draw_text("Raspberry Pi Pip-Boy", 250, 20, font_size=48)
    draw_text("System Status: Nominal", 250, 100, font_size=24)
    draw_text("Press [Tab] for next, [Shift+Tab] for previous", 250, HEIGHT - 60, font_size=24)

def draw_gps_screen():
    screen_content.fill(BLACK)  # Clear the screen content surface
    draw_text("GPS: Searching...", 50, 20, font_size=24)
    draw_text("Status: Not Locked", 50, 60, font_size=24)
    draw_text("Press [Tab] for next, [Shift+Tab] for previous", 250, HEIGHT - 60, font_size=24)

def draw_wiki_screen():
    screen_content.fill(BLACK)  # Clear the screen content surface
    draw_text("Offline Wiki: Ready", 50, 20, font_size=24)
    draw_text("Press [Tab] for next, [Shift+Tab] for previous", 250, HEIGHT - 60, font_size=24)

def draw_radio_screen():
    screen_content.fill(BLACK)  # Clear the screen content surface
    draw_text("Radio: Scanning...", 50, 20, font_size=24)
    draw_text("Press [Tab] for next, [Shift+Tab] for previous", 250, HEIGHT - 60, font_size=24)

def main():
    global current_screen, previous_screen
    clock = pygame.time.Clock()

    screens = [MAIN_SCREEN, GPS_SCREEN, WIKI_SCREEN, RADIO_SCREEN]
    while True:
        if current_screen != previous_screen:
            fade_out()  # Fade out to avoid flashing
            screen.fill(BLACK)  # Clear the screen to avoid previous content
            previous_screen = current_screen  # Update previous screen for comparison
            fade_in()  # Fade in the new screen

        # Draw the appropriate screen content
        if current_screen == MAIN_SCREEN:
            draw_main_screen()
        elif current_screen == GPS_SCREEN:
            draw_gps_screen()
        elif current_screen == WIKI_SCREEN:
            draw_wiki_screen()
        elif current_screen == RADIO_SCREEN:
            draw_radio_screen()

        screen.blit(screen_content, (0, 0))  # Blit the content surface onto the screen
        pygame.display.flip()  # Update the display

        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
                sys.exit()
            elif event.type == pygame.KEYDOWN:
                # Move to the next screen (Tab key)
                if event.key == pygame.K_TAB and not pygame.key.get_pressed()[pygame.K_LSHIFT] and not pygame.key.get_pressed()[pygame.K_RSHIFT]:
                    current_screen = screens[(screens.index(current_screen) + 1) % len(screens)]
                # Move to the previous screen (Shift + Tab)
                elif event.key == pygame.K_TAB and (pygame.key.get_pressed()[pygame.K_LSHIFT] or pygame.key.get_pressed()[pygame.K_RSHIFT]):
                    current_screen = screens[(screens.index(current_screen) - 1) % len(screens)]

        clock.tick(30)  # Control the frame rate to avoid unnecessary updates

if __name__ == "__main__":
    main()
